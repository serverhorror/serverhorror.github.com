---
comments: true
date: 2008-11-25 15:00:00
layout: post
slug: ssh-grief
title: SSH grief
wordpress_id: 224
tags:
- sysadmin
---

[simonw](http://www.debian-administration.org/users/simonw) over at [debian-administration.org](http://www.debian-administration.org/) seems to have a [problem with SSH Auth on busy servers](http://www.debian-administration.org/users/simonw/weblog/290). I've had a few hosts out in the wild with ssh on port 22 and was suffering similiar problems.

    
    ssh_exchange_identification: Connection closed by remote host


My solution was to have these options in sshd_config:



	
  * AllowGroups: AllowGroups sshusers

	
  * MaxStartups: MaxStartups 5:90:10


These 2 options solved the problems for me. On a busy host you might want to look at the [sshd_config manpage.](http://www.openbsd.org/cgi-bin/man.cgi?query=sshd_config&sektion=5)

Another helpful options is: [ControlMaster from the ssh_config manpade](http://www.openbsd.org/cgi-bin/man.cgi?query=ssh_config&sektion=5)

What this does it that for a given hostname and username combination it reuses the connection so that on subsequent logins you can login without entering the passwort and in most cases almost immediately as sshd doesn't need to run another process since it reuses the one already existing.
